# 色彩科学（Color Science）

## Gamma

### OETF 和 EOTF

近似地，

-   相机传感器读出电压与输入光功率成 1 次方关系。
-   CRT 显示器的输出功率与输入电压成 2.5 次方关系。
-   LCD 显示器的输出功率与输入电压成 1 次方关系。

为了还原拍摄的画面，我们应当让输出光功率和输入光功率相等。
对于早期的 CRT 时代，为了降低成本，都是预先在摄影机上将接受到的光通过近似于 1/2.5 次方输出，这样 CRT 显示器就可以直接观看。（实际上这个值大多是 2.2，考虑到电视多在暗处观看）这一现象一直保留到现在。

### 人眼亮度感知

然而人眼在更亮的时候对亮度更加不敏感，因此在存储亮度时，如果精细程度是固定的，我们更应当将精细程度分配到暗部。这时相机上继续使用 Gamma 1/2.2 曲线存储便是一个不错的选择。请注意在这一情况下，如果使用 0~255 表示亮度，那么 0~1 和 254~255 之间的功率差是不一致的。

### Log

Log 最早可以追溯到胶片时代，基于光密度法的胶片成像原理，绘制出以曝光量为横轴，光密度在纵轴上的变化量的曲线。

数字时代的Log，各大厂商都有自己的Log曲线，提供了一种更高宽容度的解决方法，允许记录更多的亮度细节。如佳能的C-Log，索尼的S-Log，富士的F-Log，松下的V-Log，大疆的D-Log 等，不论哪种Log，本质也是一种 OETF 和 EOTF 曲线。

Log 往往能够扩展相较于常规 Gamma 曲线更亮和更暗的部分，因此在正确曝光时，Log 模式下拍摄的内容在直方图上往往呈现在中间部分。若不进行正确的转换，将 Log 当做常规 Gamma 播放，会认为画面是“灰蒙蒙”的。

下面就以索尼 S-Log 及达芬奇软件举例介绍几种高效、准确的校色及色彩匹配的方式。

## 色彩空间

色彩空间用以描述颜色通道数值在实际光学中的范围。具体来讲即 RGB 三个通道的数值在实际光学中能够表示的颜色范围。

理论上色彩空间应当搭配其对应的 Gamma 曲线使用，例如 Sgamut3.Cine 色彩空间搭配 SLog3 使用。

### S-Gamut
S-Gamut 是索尼定义的一个色彩空间。
有三种 S-Gamut：S-Gamut、S-Gamut3 和 S-Gamut.Cine。请参考下图的色彩空间显示：

#### S-Gamut / S-Gamut3
S-Gamut 和 S-Gamut3 的色彩空间比 S-Gamut3.Cine 要大一些，因此可调整范围广。此二者具有相同的空间范围，但是 S-Gamut3 则在色彩再现上有所改善。
#### S-Gamut3.Cine
S-Gamut3.Cine 的色彩空间比 DCI-P3 稍微大一些，使用 S-Gamut3.Cine 和 S-Log3，结合 S-Log3 其灰阶近似胶片负片扫描的特点，则能够使拍摄的视频更容易处理，然后在数字影院放映机等设备上播放。 

### LUT

LUT（Look Up Table），颜色查找表，用于将一组 R、G、B 数据转换为另一组 R、G、B 数据。这种对应关系可以被保存成文件，目前一般采用 `.cube` 为后缀的 3D LUT。由于 $256^3\times 3=50,331,648$ 字节（约50MB）这仅仅是 8bit LUT，因此将每个 RGB 值的对应关系均写入 LUT 是不经济的。我们一般将 256 档的 RGB 值量化至为 17 档（或33、65，精度更高），后保存，其他数值通过插值计算。  
两组色彩空间和 Gamma 曲线可以通过 LUT 进行转换。  

在使用 Davinci Resolve 时不推荐使用 LUT 进行色彩空间转换，3D LUT 对于颜色的改变是粗暴的对照替换，使用之后数据发生改变，可能会造成部分细节的丢失。

### 色彩空间转换

在 Davinci Resolve 中，默认效果库内有一个色彩空间转换（Color Space Transform）。色彩空间转换不同于 3D LUT，它是基于 Davinci Resolve 内部的函数运算而得到的效果，使用后也能保证信息的相对完整，并且对画面颜色的识别能力也大大优于 3D LUT。

## 白平衡

此问题的本质是人眼可以自动地将环境中的光源（如果它近似是白色的话）认定为白色的基准。但实际上它可能是偏色的，但我们不知道观看者的观看环境光源，因此我们让相机进行前期处理，将环境光颜色定义为标准的白色，显示设备的白平衡由显示设备控制（固定为背光颜色、可设置、或例如 Apple 设备的原彩显示〔True Tone〕的自动调节）。

白平衡一般分为两个维度，即色温和色调。理论上应当与环境光线匹配。  

多设备拍摄时，无论是否准确，都务必让所有设备保持在相同的白平衡设置。  

在有独立白平衡传感器的设备上，自动白平衡较为准确，否则请勿过分相信自动白平衡。

## 使用色卡

色卡常作为协助前期与后期进行色彩校准的存在。简略情况下，人们通常用白纸进行白平衡的校准，在某些情况下白纸对光的反射没有色卡来得准确。色卡的优势还在于可以将真实世界的色彩作为参照，数据化后映射到视频素材上。

色卡的使用非常简单。在前期拍摄时，先在拍摄光源下拍摄一段色卡素材，这里要注意前期拍摄时色卡要受光均匀，不能让阴影投射在色卡上，也不能让色卡反光。在后期调整时，仍以 Davinci Resolve 为例，在调色界面选择色彩匹配面板，根据色卡的型号，将色卡选项选到相应的选项上，保持色卡与匹配颜色是一致的。

在色彩匹配面板中，可以看出色彩校正实际上是对画面显示颜色进行正确的差值运算，最终实现画面中颜色的校正。
